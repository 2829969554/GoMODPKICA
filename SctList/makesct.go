package main
import(
	"fmt"
	"encoding/hex"
	"errors"
	"time"
)

func main(){
	var SCTtemplate SCT
	err := errors.New("这是一个错误")
	SCTtemplate.Version = 0
	SCTtemplate.LogID ,err= hex.DecodeString("12F14E34BD53724C840619C38F3F7A13F8E7B56287889C6D300584EBE586263A")
	SCTtemplate.Timestamp = uint64(time.Now().UTC().UnixMilli())
	SCTtemplate.Hash = 4
	SCTtemplate.Signtype = 3
	SCTtemplate.Signature,err = hex.DecodeString("463044022042ee56f3663b32a6ddf1504781c2f217803d5c12132f4a993fe55f8629dcdd5902207047e087faa3a611bb8d0de198ccfa01b265dc0f6c7c6392d848ad32fd4ecb1e")
	status,data:= SCTtemplate.CreateSCT()
	if(err != nil){
		fmt.Println(err)
	}
	fmt.Println("Hi Make SCT")
	//mysct := []byte{0x75,0x00,0x12,0xF1,0x4E,0x34,0xBD,0x53,0x72,0x4C,0x84,0x06,0x19,0xC3,0x8F,0x3F,0x7A,0x13,0xF8,0xE7,0xB5,0x62,0x87,0x88,0x9C,0x6D,0x30,0x05,0x84,0xEB,0xE5,0x86,0x26,0x3A,0x00,0x00,0x01,0x91,0x44,0xA4,0xE4,0x5E,0x00,0x00,0x04,0x03,0x00,0x46,0x30,0x44,0x02,0x20,0x42,0xEE,0x56,0xF3,0x66,0x3B,0x32,0xA6,0xDD,0xF1,0x50,0x47,0x81,0xC2,0xF2,0x17,0x80,0x3D,0x5C,0x12,0x13,0x2F,0x4A,0x99,0x3F,0xE5,0x5F,0x86,0x29,0xDC,0xDD,0x59,0x02,0x20,0x70,0x47,0xE0,0x87,0xFA,0xA3,0xA6,0x11,0xBB,0x8D,0x0D,0xE1,0x98,0xCC,0xFA,0x01,0xB2,0x65,0xDC,0x0F,0x6C,0x7C,0x63,0x92,0xD8,0x48,0xAD,0x32,0xFD,0x4E,0xCB,0x1E}

	if(status){
		//if(hex.EncodeToString(data) == hex.EncodeToString(mysct)){
			fmt.Println("完全一致",hex.EncodeToString(data))
			var mySCTlist SCTList
			
			mySCTlist.SCTs= append(mySCTlist.SCTs,SCTtemplate)
			a,b:= mySCTlist.CreateSCTList()
			if(a){
				//这里生成的数据可以直接嵌入X509证书
				
				fmt.Println("SCT列表数据生成成功\n",hex.EncodeToString(b))

				fmt.Print("\nopenssl x509 v3扩展配置\n ct_precert_scts=DER:")
				for i := 0; i < len(b); i++ {
					str := fmt.Sprintf("%x",b[i])
					if(len(str) < 2){
						str = "0" + str
					}
					
					if(len(b)-1 == i){
						fmt.Print(str)
					}else{
						fmt.Print(str,":")
					}
				}
			}else{
				err = errors.New("SCT LIST签发失败")
			}

	/*	}else{
			fmt.Println("不一致\n",hex.EncodeToString(mysct),"\n",hex.EncodeToString(data))

			fmt.Println("不一致\n",len(mysct),"\n",(data))
			fmt.Println("不一致\n",mysct,"\n",data)
		}
	*/	
	}else{
		err = errors.New("SCT签发失败")
		fmt.Println(err)
	}
}